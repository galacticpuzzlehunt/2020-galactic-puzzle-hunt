/*! @license pzpr.js v (c) 2009-2021 sabo2, MIT license
 *   https://github.com/sabo2/pzprv3 */

!function(){function a(a,b){if(a.length!==b.length)return!1;for(var c=0;c<b.length;c++)if(a[c]!==b[c])return!1;return!0}!function(a,b){"object"==typeof module&&module.exports?module.exports=[a,b]:pzpr.classmgr.makeCustom(a,b)}(["tapaloop"],{MouseEvent:{inputModes:{edit:[],play:["line","peke","subcircle","subcross","info-line"]},mouseinput_auto:function(){this.puzzle.playmode?"left"===this.btn?this.mousestart||this.mousemove?this.inputLine():this.mouseend&&this.notInputted()&&(this.inputpeke_ifborder()||this.inputMB()):"right"===this.btn&&(this.mousestart||this.mousemove?this.inputpeke():this.mouseend&&this.notInputted()&&(this.inputpeke_ifborder()||this.inputMB())):this.puzzle.editmode&&this.mousestart&&this.setcursor(this.getcell())}},KeyEvent:{enablemake:!0,keyinput:function(a){this.key_inputqnum_tapaloop(a)},key_inputqnum_tapaloop:function(a){var b=this.cursor.getc(),c=b.qnums,d=[];if("0"<=a&&a<="8"||"-"===a){var e="-"!==a?+a:-2;if(this.prev===b&&c.length<=3)for(var f=0;f<c.length;f++)d.push(c[f]);if(d.push(e),d.length>1){for(var g=0,f=0;f<d.length;f++)g+=d[f]>=0?d[f]:1;if(g>8)d=[e];else for(var f=0;f<d.length;f++)if(0===d[f]){d=[e];break}}}else if("BS"===a){if(c.length>1)for(var f=0;f<c.length-1;f++)d.push(c[f])}else{if(" "!==a)return;d=[]}b.setNums(d),this.prev=b,b.draw()}},Cell:{qnums:[],noLP:function(a){return 0!==this.qnums.length},setNums:function(a){this.setQnums(a),this.setQans(0),this.setQsub(0)},setQnums:function(b){a(this.qnums,b)||(this.addOpeQnums(this.qnums,b),this.qnums=b)},addOpeQnums:function(b,c){a(b,c)||this.puzzle.opemgr.add(new this.klass.ObjectOperation2(this,b,c))},getSegmentLengths:function(){for(var a=[],b=0,c=[[-2,-2],[0,-2],[2,-2],[2,0],[2,2],[0,2],[-2,2],[-2,0]],d=[[-1,-2],[1,-2],[2,-1],[2,1],[1,2],[-1,2],[-2,1],[-2,-1]],e=0;e<8;e++){if(0===b){var f=this.relcell(c[e][0],c[e][1]);if(!(f&&f.lcnt>0))continue;b=1}var g=this.relbd(d[e][0],d[e][1]);g&&g.isLine()?b++:(a.push(b),b=0)}return b>0&&a.push(b),0===a.length?a.push(0):this.relbd(-2,-1).isLine()&&(a[0]+=a[a.length-1]-1,a.pop()),a}},CellList:{allclear:function(a){this.common.allclear.call(this,a);for(var b=0;b<this.length;b++){var c=this[b];c.qnums.length>0&&(a&&c.addOpeQnums(c.qnums,[]),c.qnums=[])}}},"ObjectOperation2:Operation":{setData:function(a,b,c){this.bx=a.bx,this.by=a.by,this.old=b,this.val=c,this.property="qnums"},decode:function(a){if("CR"!==a.shift())return!1;this.bx=+a.shift(),this.by=+a.shift();var b=a.join(","),c=b.substr(1,b.length-2).split(/\],\[/);if(0===c[0].length)this.old=[];else{this.old=c[0].split(/,/);for(var d=0;d<this.old.length;d++)this.old[d]=+this.old[d]}if(0===c[1].length)this.val=[];else{this.val=c[1].split(/,/);for(var d=0;d<this.val.length;d++)this.val[d]=+this.val[d]}return!0},toString:function(){return["CR",this.bx,this.by,"["+this.old.join(",")+"]","["+this.val.join(",")+"]"].join(",")},isModify:function(b){return!(b.property!==this.property||b.bx!==this.bx||b.by!==this.by||!a(b.val,this.old))&&(b.val=this.val,!0)},undo:function(){this.exec(this.old)},redo:function(){this.exec(this.val)},exec:function(a){var b=this.puzzle,c=b.board.getc(this.bx,this.by);c.setQnums(a),c.draw(),b.checker.resetCache()}},OperationManager:{addExtraOperation:function(){this.operationlist.push(this.klass.ObjectOperation2)}},Border:{enableLineNG:!0},Board:{hasborder:1},LineGraph:{enabled:!0},Graphic:{irowake:!0,gridcolor_type:"SLIGHT",paint:function(){this.drawBGCells(),this.drawGrid(),this.drawTapaNumbers(),this.drawMBs(),this.drawPekes(),this.drawLines(),this.drawChassis(),this.drawTarget()}},Encode:{decodePzpr:function(a){this.decodeNumber_tapaloop()},encodePzpr:function(a){this.encodeNumber_tapaloop()},decodeNumber_tapaloop:function(){var a=0,b=0,c=this.outbstr,d=this.board;for(b=0;b<c.length;b++){var e=d.cell[a],f=c.charAt(b);if(this.include(f,"0","8"))e.qnums=[parseInt(f,10)];else if("."===f)e.qnums=[-2];else if(this.include(f,"a","f")){var g=parseInt(c.substr(b,2),36),h=[];g>=360&&(g-=360,h=[0,0],h[0]=g/8|0,g-=8*h[0],h[1]=g);for(var i=0;i<4;i++)0===h[i]&&(h[i]=-2);e.qnums=h,b++}else if("+"===f){var g=parseInt(c.substr(b+1,2),36)-36,h=[0,0,0];h[0]=g/49|0,g-=49*h[0],h[1]=g/7|0,g-=7*h[1],h[2]=g;for(var i=0;i<4;i++)0===h[i]&&(h[i]=-2);e.qnums=h,b+=2}else if("-"===f){var g=parseInt(c.substr(b+1,2),36)-36,h=[0,0,0,0];h[0]=g/216|0,g-=216*h[0],h[1]=g/36|0,g-=36*h[1],h[2]=g/6|0,g-=6*h[2],h[3]=g;for(var i=0;i<4;i++)0===h[i]&&(h[i]=-2);e.qnums=h,b+=2}else f>="g"&&f<="z"&&(a+=parseInt(f,36)-16);if(a++,!d.cell[a])break}this.outbstr=c.substr(b+1)},encodeNumber_tapaloop:function(){for(var a=0,b="",c=this.board,d=0;d<c.cell.length;d++){var e="",f=c.cell[d].qnums;1===f.length?e=-2===f[0]?".":f[0].toString(10):2===f.length?e=(8*(f[0]>0?f[0]:0)+(f[1]>0?f[1]:0)+360).toString(36):3===f.length?e="+"+(49*(f[0]>0?f[0]:0)+7*(f[1]>0?f[1]:0)+(f[2]>0?f[2]:0)+36).toString(36):4===f.length?e="-"+(216*(f[0]>0?f[0]:0)+36*(f[1]>0?f[1]:0)+6*(f[2]>0?f[2]:0)+(f[3]>0?f[3]:0)+36).toString(36):a++,0===a?b+=e:(e||20===a)&&(b+=(15+a).toString(36)+e,a=0)}a>0&&(b+=(15+a).toString(36)),this.outbstr+=b}},FileIO:{decodeData:function(){this.decodeQnums_tapaloop(),this.decodeBorderLine()},encodeData:function(){this.encodeQnums_tapaloop(),this.encodeBorderLine()},decodeQnums_tapaloop:function(){this.decodeCell(function(a,b){if("."!==b){a.qnums=[];for(var c=b.split(/,/),d=0;d<c.length;d++)a.qnums.push("-"!==c[d]?+c[d]:-2)}})},encodeQnums_tapaloop:function(){this.encodeCell(function(a){if(a.qnums.length>0){for(var b=[],c=0;c<a.qnums.length;c++)b.push(a.qnums[c]>=0?""+a.qnums[c]:"-");return b.join(",")+" "}return". "})}},AnsCheck:{checklist:["checkBranchLine","checkCrossLine","checkTapaloop","checkDeadendLine+","checkOneLoop"],checkTapaloop:function(){this.checkAllCell(function(a){if(0===a.qnums.length)return!1;var b=a.getSegmentLengths();if(a.qnums.length!==b.length)return!0;for(var c=0;c<a.qnums.length;c++){var d=a.qnums[c];if(-2!==d){var e=b.indexOf(d);if(e<0)return!0;b.splice(e,1)}}},"tapaloopError")}},FailCode:{tapaloopError:["(please translate) The segments around a clue are not the same length as the numbers.","The segments around a clue are not the same length as the numbers."]}})}();
//# sourceMappingURL=tapaloop.js.map