/*! @license pzpr.js v (c) 2009-2021 sabo2, MIT license
 *   https://github.com/sabo2/pzprv3 */

!function(a,b){"object"==typeof module&&module.exports?module.exports=[a,b]:pzpr.classmgr.makeCustom(a,b)}(["nurimaze"],{MouseEvent:{use:!0,inputModes:{edit:["border","mark-circle","mark-triangle"],play:["shade","unshade"]},mouseinput:function(){"shade"===this.inputMode||"unshade"===this.inputMode?this.inputtile_nurimaze():this.common.mouseinput.call(this)},mouseinput_other:function(){0===this.inputMode.indexOf("mark-")&&this.inputmarks()},mouseinput_auto:function(){this.puzzle.playmode?(this.mousestart||this.mousemove)&&this.inputtile_nurimaze():this.puzzle.editmode&&(this.mousestart||this.mousemove?this.inputEdit():this.mouseend&&this.inputEdit_end())},inputtile_nurimaze:function(){var a=this.getcell();if(!a.isnull&&a!==this.mouseCell){null===this.inputData&&this.decIC(a);var b=this.board,c=a.room.clist;if(1===this.inputData)for(var d=0;d<c.length;d++)if(0!==c[d].ques||b.startpos.equals(c[d])||b.goalpos.equals(c[d])){if(this.mousestart){this.inputData=1!==a.qsub?2:0;break}return}this.mouseCell=a;for(var d=0;d<c.length;d++){var e=c[d];(1===this.inputData?e.setShade:e.clrShade).call(e),e.setQsub(2===this.inputData?1:0)}c.draw()}},inputEdit:function(){var a=this.getcell();a.isnull||(null===this.inputData&&this.inputEdit_first(),10===this.inputData?this.board.startpos.input(a):11===this.inputData?this.board.goalpos.input(a):null!==this.inputData&&this.inputborder())},inputEdit_first:function(){var a=this.getpos(.33),b=this.board;b.startpos.equals(a)?this.inputData=10:b.goalpos.equals(a)?this.inputData=11:this.inputborder()},inputEdit_end:function(){var a=this.getcell();a.isnull||(10===this.inputData||11===this.inputData?(this.inputData=null,a.draw()):this.notInputted()&&(a!==this.cursor.getc()?this.setcursor(a):this.inputQuesMark(a)))},inputmarks:function(){var a=this.getcell();a.isnull||a===this.mouseCell||(this.inputQuesMark(a),this.mouseCell=a)},inputQuesMark:function(a){var b=this.board,c=-1;if("mark-circle"===this.inputMode)c=41!==a.ques?41:0;else if("mark-triangle"===this.inputMode)c=42!==a.ques?42:0;else if("left"===this.btn)c={0:41,41:42,42:0}[a.ques];else{if("right"!==this.btn)return;c={0:42,42:41,41:0}[a.ques]}0!==c&&(b.startpos.equals(a)||b.goalpos.equals(a))||(a.setQues(c),a.draw())}},KeyEvent:{enablemake:!0,keyinput:function(a){this.keydown&&this.puzzle.editmode&&this.key_inputqnum_nurimaze(a)},key_inputqnum_nurimaze:function(a){var b=this.cursor.getc(),c=this.board,d=b.ques,e=-1;if("1"===a||"q"===a)e=41!==d?41:0;else if("2"===a||"w"===a)e=42!==d?42:0;else if("3"===a||"e"===a||" "===a||"BS"===a)e=0;else if("s"===a)c.startpos.input(b);else{if("g"!==a)return;c.goalpos.input(b)}e===d||0!==e&&(c.startpos.equals(b)||c.goalpos.equals(b))||(b.setQues(e),b.draw())}},Board:{hasborder:1,startpos:null,goalpos:null,createExtraObject:function(){var a=this.klass;this.startpos=new a.StartAddress(1,1),this.goalpos=new a.GoalAddress(2*this.cols-1,2*this.rows-1),this.startpos.partner=this.goalpos,this.goalpos.partner=this.startpos},initExtraObject:function(a,b){this.disableInfo(),this.startpos.init(1,1),this.goalpos.init(2*a-1,2*b-1),this.enableInfo()},exchangestartgoal:function(){var a=this.startpos.getc(),b=this.goalpos.getc();this.startpos.set(b),this.goalpos.set(a),this.startpos.draw(),this.goalpos.draw()}},BoardExec:{posinfo:{},adjustBoardData:function(a,b){var c=this.board;this.posinfo_start=this.getAfterPos(a,b,c.startpos.getc()),this.posinfo_goal=this.getAfterPos(a,b,c.goalpos.getc())},adjustBoardData2:function(a,b){var c,d=this.board,e=this.puzzle.opemgr,f=this.posinfo_start,g=this.posinfo_goal;c=a&this.REDUCE&&(f.isdel||g.isdel)&&!e.undoExec&&!e.redoExec,c&&(e.forceRecord=!0),d.startpos.set(f.pos.getc()),d.goalpos.set(g.pos.getc()),c&&(e.forceRecord=!1)}},OperationManager:{addExtraOperation:function(){this.operationlist.push(this.klass.StartGoalOperation)}},AreaUnshadeGraph:{enabled:!0},AreaRoomGraph:{enabled:!0},Graphic:{enablebcolor:!0,bgcellcolor_func:"qsub1",errbcolor2:"rgb(192, 192, 255)",bbcolor:"rgb(96, 96, 96)",paint:function(){this.drawBGCells(),this.drawShadedCells(),this.drawGrid(),this.drawQuesMarks(),this.drawStartGoal(),this.drawBorders(),this.drawChassis(),this.drawBoxBorders(!0),this.drawTarget()},drawQuesMarks:function(){var a=this.vinc("cell_mark","auto",!0),b=.3*this.cw,c=.26*this.cw;a.lineWidth=2;for(var d=this.range.cells,e=0;e<d.length;e++){var f=d[e],g=f.ques,h=f.bx*this.bw,i=f.by*this.bh;a.strokeStyle=this.getQuesNumberColor(f),a.vid="c_mk1_"+f.id,41===g?a.strokeCircle(h,i,b):a.vhide(),a.vid="c_mk2_"+f.id,42===g?(a.beginPath(),a.setOffsetLinePath(h,i,0,-c,-b,c,b,c,!0),a.stroke()):a.vhide()}}},Encode:{decodePzpr:function(a){this.decodeBorder(),this.decodeCell_nurimaze()},encodePzpr:function(a){this.encodeBorder(),this.encodeCell_nurimaze()},decodeCell_nurimaze:function(){var a=0,b=0,c=this.outbstr,d=this.board;for(b=0;b<c.length;b++){var e=c.charAt(b),f=d.cell[a];if("1"===e?d.startpos.set(f):"2"===e?d.goalpos.set(f):"3"===e?f.ques=41:"4"===e?f.ques=42:(this.include(e,"5","9")||this.include(e,"a","z"))&&(a+=parseInt(e,36)-5),a++,!d.cell[a])break}this.outbstr=c.substr(b+1)},encodeCell_nurimaze:function(){for(var a="",b=0,c=this.board,d=0;d<c.cell.length;d++){var e="",f=c.cell[d];c.startpos.equals(f)?e="1":c.goalpos.equals(f)?e="2":41===f.ques?e="3":42===f.ques?e="4":b++,0===b?a+=e:(e||31===b)&&(a+=(4+b).toString(36)+e,b=0)}b>0&&(a+=(4+b).toString(36)),this.outbstr+=a}},FileIO:{decodeData:function(){this.decodeAreaRoom(),this.decodeCellQues_nurimaze(),this.decodeCellAns()},encodeData:function(){this.encodeAreaRoom(),this.encodeCellQues_nurimaze(),this.encodeCellAns()},decodeCellQues_nurimaze:function(){var a=this.board;this.decodeCell(function(b,c){"s"===c?a.startpos.set(b):"g"===c?a.goalpos.set(b):"o"===c?b.ques=41:"t"===c&&(b.ques=42)})},encodeCellQues_nurimaze:function(){var a=this.board;this.encodeCell(function(b){return a.startpos.equals(b)?"s ":a.goalpos.equals(b)?"g ":41===b.ques?"o ":42===b.ques?"t ":". "})}},AnsCheck:{checklist:["checkSameColorTile","checkShadedObject","checkConnectUnshade","check2x2ShadeCell+","check2x2UnshadeCell++","checkUnshadeLoop","checkRouteCheckPoint","checkRouteNoDeadEnd","doneShadingDecided"],checkShadedObject:function(){var a=this.board;this.checkAllCell(function(b){return 1===b.qans&&(0!==b.ques||a.startpos.equals(b)||a.goalpos.equals(b))},"objShaded")},check2x2UnshadeCell:function(){this.check2x2Block(function(a){return a.isUnshade()},"cu2x2")},checkUnshadeLoop:function(){for(var a=this.board,b=a.ublkmgr.components,c=0;c<b.length;c++)if(0!==b[c].circuits){if(this.failcode.add("cuLoop"),this.checkOnly)return;this.searchloop(b[c]).seterr(1)}},checkRouteCheckPoint:function(){var a=this.getMazeRouteInfo();if(a.outroute.filter(function(a){return 41===a.ques}).length>0){if(this.failcode.add("routeIgnoreCP"),this.checkOnly)return;a.onroute.seterr(1)}},checkRouteNoDeadEnd:function(){var a=this.getMazeRouteInfo();if(a.onroute.filter(function(a){return 42===a.ques}).length>0){if(this.failcode.add("routePassDeadEnd"),this.checkOnly)return;a.onroute.seterr(1)}},searchloop:function(a){if(a.circuits<=0)return new this.klass.CellList;for(var b=this.board,c=new this.klass.CellList,d=[a.clist[0]],e=null,f={},g=b.maxbx-b.minbx;d.length>0;){var h=d[d.length-1],i=null,j=f[h.by*g+h.bx];if(void 0===j)j=f[h.by*g+h.bx]=d.length-1;else if(d.length-1>j)for(var k=d.length-2;k>=0&&("cell"===d[k].group&&c.add(d[k]),d[k]!==h);k--);if("cell"===h.group){e=h;for(var k=0;k<h.ublknodes[0].nodes.length;k++){var l=h.ublknodes[0].nodes[k].obj,m=b.getb(h.bx+l.bx>>1,h.by+l.by>>1);if(void 0===f[m.by*g+m.bx]){i=m;break}}}else for(var k=0;k<h.sidecell.length;k++){var n=h.sidecell[k];if(n!==e&&n!==d[d.length-2]){i=n;break}}i?d.push(i):d.pop()}return c},getMazeRouteInfo:function(){if(this._info.maze)return this._info.maze;for(var a=this.board,b=[a.startpos.getc()],c={},d={},e=a.maxbx-a.minbx;b.length>0;){var f=b[b.length-1],g=null,h=c[f.by*e+f.bx];if(void 0===h&&(h=c[f.by*e+f.bx]=b.length-1),a.goalpos.equals(f))for(var i=b.length-1;i>=0;i--)d[b[i].by*e+b[i].bx]=!0;for(var j=f.ublknodes[0]?f.ublknodes[0].nodes:[],i=0;i<j.length;i++){var k=j[i].obj;if(void 0===c[k.by*e+k.bx]){g=k;break}}g?b.push(g):b.pop()}for(var l={onroute:new this.klass.CellList,outroute:new this.klass.CellList},m=0;m<a.cell.length;m++){var f=a.cell[m];f.isUnshade()&&(d[f.by*e+f.bx]?l.onroute.add(f):l.outroute.add(f))}return this._info.maze=l}},FailCode:{cu2x2:["2x2の白マスのカタマリがあります。","There is a 2x2 block of unshaded cells."],cuLoop:["白マスで輪っかができています。","There is a looped unshaded cells."],routeIgnoreCP:["○がSからGへの経路上にありません。","There is a circle out of the shortest route from S to G."],routePassDeadEnd:["△がSからGへの経路上にあります。","There is a triangle on the shortest route from S to G."],objShaded:["オブジェクトが黒マスになっています。","An object is shaded."]}});
//# sourceMappingURL=nurimaze.js.map