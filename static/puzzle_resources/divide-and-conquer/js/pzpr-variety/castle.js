/*! @license pzpr.js v (c) 2009-2021 sabo2, MIT license
 *   https://github.com/sabo2/pzprv3 */

!function(a,b){"object"==typeof module&&module.exports?module.exports=[a,b]:pzpr.classmgr.makeCustom(a,b)}(["castle"],{MouseEvent:{inputModes:{edit:["number","direc","shade","clear","info-line"],play:["line","peke","completion","info-line"]},mouseinput_auto:function(){this.puzzle.playmode?"left"===this.btn?this.mousestart||this.mousemove?this.inputLine():this.mouseend&&this.notInputted()&&(this.inputpeke_ifborder(),this.notInputted()&&this.inputqcmp()):"right"===this.btn&&(this.mousestart||this.mousemove)&&this.inputpeke():this.puzzle.editmode&&(this.mousestart||this.mousemove?this.inputdirec():this.mouseend&&this.notInputted()&&this.inputqnum())},inputqcmp:function(){var a=this.getcell();a.isnull||a.noNum()||(a.setQcmp(+!a.qcmp),a.draw(),this.mousereset())},inputShade:function(){var a=this.getcell();a.isnull||a===this.mouseCell||(null===this.inputData&&(-1===a.qnum?this.inputData=0:this.inputData=[2,0,1][a.ques]),a.setQues(this.inputData),-1===a.qnum&&a.setQnum(-2),a.drawaround(),this.mouseCell=a)}},KeyEvent:{enablemake:!0,moveTarget:function(a){return!a.match(/shift/)&&this.moveTCell(a)},keyinput:function(a){if("q"===a){var b=this.cursor.getc();return-1===b.qnum?b.setQnum(-2):b.setQues([2,0,1][b.ques]),this.prev=b,void b.draw()}this.key_inputdirec(a)||this.key_inputqnum(a)}},Cell:{minnum:0,maxnum:function(){return Math.max(this.board.cols-2,this.board.rows-2)},noLP:function(a){return this.isNum()},isUndecided:function(){return!this.isNum()&&this.lcnt<2},posthook:{qnum:function(a){-1===a&&this.setQues(0)}},actual:null,undecided:!0,isCmp:function(){if(1===this.qcmp)return!0;if(!this.puzzle.execConfig("autocmp"))return!1;var a=this.qdir;return!(!this.isValidNum()||0===a)&&(this.recount(),!this.undecided&&this.actual===this.qnum)},recount:function(){if(null===this.actual){var a=this.qdir;if(this.isValidNum()&&0!==a){this.actual=0,this.undecided=!1;var b=this.getaddr();for(b.movedir(a,1);;){b.movedir(a,2);var c=b.getb();if(!c||c.isnull)break;c.isLine()?this.actual++:0===c.qsub&&c.sidecell[0].isUndecided()&&c.sidecell[1].isUndecided()&&(this.undecided=!0)}}}},invalidate:function(){this.actual=null,this.draw()}},Border:{enableLineNG:!0,isBorder:function(){return this.sidecell[0].ques!==this.sidecell[1].ques||-1===this.sidecell[0].qnum!=(-1===this.sidecell[1].qnum)},prehook:{qsub:function(){return-1!==this.sidecell[0].qnum||-1!==this.sidecell[1].qnum}},posthook:{line:function(){this.redrawAroundBorder()},qsub:function(){this.redrawAroundBorder()}},redrawAroundBorder:function(){this.board.scanResult=null;var a=this.sidecell[0],b=this.sidecell[1],c=this.board.cellinside(a.bx,1,a.bx,this.board.maxby),d=this.board.cellinside(1,a.by,this.board.maxbx,a.by);this.isvert?c.extend(this.board.cellinside(b.bx,1,b.bx,this.board.maxby)):d.extend(this.board.cellinside(1,b.by,this.board.maxbx,b.by)),d.each(function(a){a.qdir!==a.LT&&a.qdir!==a.RT||a.invalidate()}),c.each(function(a){a.qdir!==a.UP&&a.qdir!==a.DN||a.invalidate()})}},Board:{hasborder:1,scanResult:null,scanInside:function(){if(null!==this.scanResult)return this.scanResult;if(this.cell.some(function(a){return 0!==a.lcnt&&2!==a.lcnt}))return this.scanResult=!1,!1;for(var a=2;a<this.maxby;a+=2)for(var b=!1,c=1;c<this.maxbx;c+=2)this.getb(c,a).isLine()&&(b^=!0),this.getx(c+1,a).inside=b;return this.scanResult=!0,!0},rebuildInfo:function(){this.scanResult=null,this.cell.each(function(a){a.isValidNum()&&a.invalidate()}),this.common.rebuildInfo.call(this)},subclear:function(){this.common.subclear.call(this),this.rebuildInfo()}},BoardExec:{adjustBoardData:function(a,b){this.adjustNumberArrow(a,b)}},LineGraph:{enabled:!0},Graphic:{gridcolor_type:"DLIGHT",qcmpcolor:"rgb(127,127,127)",autocmp:"number",irowake:!0,hideHatena:!0,paint:function(){this.drawBGCells(),this.drawGrid(),this.drawGridGaps(),this.drawBorders(),this.drawArrowNumbers(),this.drawLines(),this.drawPekes(),this.drawChassis(),this.drawTarget()},drawGridGaps:function(){var a,b=this.vinc("gridgaps","crispEdges",!0),c=this.board,d=this.bw,e=this.bh;for(b.lineWidth=1,a=0;a<c.border.length;a++){var f=c.border[a];if(b.vid="bdgap_"+a,-1!==f.sidecell[0].qnum&&-1!==f.sidecell[1].qnum){var g=f.sidecross[0].bx,h=f.sidecross[0].by,i=f.sidecross[1].bx,j=f.sidecross[1].by;switch(f.sidecell[0].ques){case 0:b.strokeStyle="lightgray";break;case 1:b.strokeStyle="white";break;case 2:b.strokeStyle="black"}b.strokeLine(g*d,h*e,i*d,j*e)}else b.vhide()}},getBGCellColor:function(a){return 1===(a.error||a.qinfo)?2!==a.ques?this.errbcolor1:this.errcolor1:-1!==a.qnum?0===a.ques?"lightgray":1===a.ques?"white":"black":null},getQuesNumberColor:function(a){return a.isCmp()?this.qcmpcolor:2!==a.ques?this.quescolor:"white"}},Encode:{decodePzpr:function(){var a=0,b=0,c=this.outbstr,d=this.board;for(b=0;b<c.length&&d.cell[a];b++){var e=c.charAt(b),f=d.cell[a];if(e>="a"&&e<="z")a+=parseInt(e,36)-9;else{if(f.ques=+c.charAt(b),b++,e=c.charAt(b),this.include(e,"0","4")){var g=c.charAt(b+1);f.qdir=parseInt(e,16),f.qnum="."!==g?parseInt(g,16):-2,b++}else this.include(e,"5","9")?(f.qdir=parseInt(e,16)-5,f.qnum=parseInt(c.substr(b+1,2),16),b+=2):"-"===e&&(f.qdir=parseInt(c.substr(b+1,1),16),f.qnum=parseInt(c.substr(b+2,3),16),b+=4);a++}}this.outbstr=c.substr(b+1)},encodePzpr:function(){for(var a="",b=0,c=this.board,d=0;d<c.cell.length;d++){var e="",f=c.cell[d].qdir,g=c.cell[d].qnum,h=c.cell[d].ques;-2===g||g>=0&&g<4096?(e=h.toString(16),e+=-2===g?f+".":g>=0&&g<16?f+g.toString(16):g>=16&&g<256?f+5+g.toString(16):"-"+f+g.toString(16)):b++,0===b?a+=e:(e||26===b)&&(a+=(b+9).toString(36)+e,b=0)}b>0&&(a+=(b+9).toString(36)),this.outbstr+=a}},FileIO:{decodeData:function(){this.decodeCell(function(a,b){if("."!==b){var c=b.split(",");a.qdir="0"!==c[0]?+c[0]:0,a.qnum="-"!==c[1]?+c[1]:-2;var d=+c[2];a.ques=3&d,a.qcmp=4&d?1:0}}),this.decodeBorderLine()},encodeData:function(){this.encodeCell(function(a){return[0!==a.qdir?""+a.qdir:"0",",",-2!==a.qnum?""+a.qnum:"-",",",3&a.ques|(1&a.qcmp)<<2," "].join("")}),this.encodeBorderLine()}},AnsCheck:{checklist:["checkLineExist+","checkBranchLine","checkCrossLine","checkArrowNumberGt","checkArrowNumberLt","checkDeadendLine+","checkOneLoop","checkShadedOutside","checkUnshadedInside","checkNumberHasArrow"],checkArrowNumberGt:function(){this.checkArrowNumber(1,"anLineGt")},checkArrowNumberLt:function(){this.checkArrowNumber(-1,"anLineLt")},checkArrowNumber:function(a,b){this.checkAllCell(function(b){return b.recount(),b.isValidNum()&&0!==b.qdir&&(a<0&&b.actual<b.qnum||a>0&&b.actual>b.qnum)},b)},checkShadedOutside:function(){var a=this.board;a.scanInside()&&this.checkAllCell(function(b){return-1!==b.qnum&&2===b.ques&&a.getx(b.bx-1,b.by-1).inside},"shInside")},checkUnshadedInside:function(){var a=this.board;a.scanInside()&&this.checkAllCell(function(b){return-1!==b.qnum&&1===b.ques&&!a.getx(b.bx-1,b.by-1).inside},"cuOutside")}},FailCode:{anLineLt:["矢印の方向にあるループの長さが数字よりも短いです。","The number of line segments is not correct."],anLineGt:["矢印の方向にあるループの長さが数字よりも長いです。","The number of line segments is not correct."],shInside:["黒マスがループの中にあります。","A shaded cell is inside of the loop."],cuOutside:["白マスがループの外にあります。","An unshaded cell is outside of the loop."]}});
//# sourceMappingURL=castle.js.map